

<% var username=username || '' ; %>
<% var wishListCount=wishListCount|| 0 ; %>
<% var cartCount=cartCount|| 0 ; %>
    <% if (username) { %>
        <%-include('../partials/userheader',{username,wishListCount,cartCount})-%>


 <% }else{%>
    <%-include('../partials/userheader')-%>
<%  }  %>

                        <!-- Header Section End -->

                        <!-- Breadcrumb Begin -->
                        <!-- Breadcrumb End -->

                        <!-- Shop Section Begin -->
                        
                        <div class="breadcrumb-option">
                            <div class="container">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="breadcrumb__links">
                                            <a href="/home"><i class="fa fa-home"></i> Home</a>
                                            <span>shop</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <section class="shop spad"></section>
                         <div class="container">
                            <div class="row">

                                <div class="col-lg-3 col-md-3">
                                    <div class="shop__sidebar">

                                        <div class="sidebar__categories">
                                            <div class="section-title">
                                                <h4>Categories</h4>
                                            </div>
                                            <div class="categories__accordion">
                                                <div class="accordion" id="accordionExample">
                                                    <div class="card">
                                                        <div class="card-heading">
                                                            <a data-toggle="collapse"
                                                                data-target="#collapseOne">Bags</a>
                                                        </div>
                                                        <div id="collapseOne" class="collapse show"
                                                            data-parent="#accordionExample">
                                                            <div class="card-body">
                                                                <ul>
                                                                    <% categories.forEach(function(category){ %>
                                                                        <li><a
                                                                                href="/category/<%=category.categoryname %>">
                                                                                <%=category.categoryname%>
                                                                            </a></li>
                                                                        <% }); %>

                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <!-- <div class="sidebar__filter">
                                            <div class="section-title">
                                                <h4>Shop by price</h4>
                                            </div>
                                            <div class="filter-range-wrap">
                                                <div class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content"
                                                    data-min="33" data-max="99"></div>
                                                <div class="range-slider">
                                                    <div class="price-input">
                                                        <p>Price:</p>
                                                        <input type="text" id="minamount">
                                                        <input type="text" id="maxamount">
                                                    </div>
                                                </div>
                                            </div>
                                            <a href="#">Filter</a>
                                        </div> -->
                                        <div class="sidebar__sizes">
                                            <!-- <div class="section-title">
                                <h4>Shop by size</h4>
                            </div> -->
                                            <!-- <div class="size__list">
                                <label for="xxs">
                                    xxs
                                    <input type="checkbox" id="xxs">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="xs">
                                    xs
                                    <input type="checkbox" id="xs">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="xss">
                                    xs-s
                                    <input type="checkbox" id="xss">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="s">
                                    s
                                    <input type="checkbox" id="s">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="m">
                                    m
                                    <input type="checkbox" id="m">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="ml">
                                    m-l
                                    <input type="checkbox" id="ml">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="l">
                                    l
                                    <input type="checkbox" id="l">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="xl">
                                    xl
                                    <input type="checkbox" id="xl">
                                    <span class="checkmark"></span>
                                </label>
                            </div> -->
                                        </div>
                                        <!-- <div class="sidebar__color">
                            <div class="section-title">
                                <h4>Shop by Color</h4>
                            </div>
                            <div class="size__list color__list">
                                <label for="black">
                                    Blacks
                                    <input type="checkbox" id="black">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="whites">
                                    Whites
                                    <input type="checkbox" id="whites">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="reds">
                                    Reds
                                    <input type="checkbox" id="reds">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="greys">
                                    Greys
                                    <input type="checkbox" id="greys">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="blues">
                                    Blues
                                    <input type="checkbox" id="blues">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="beige">
                                    Beige Tones
                                    <input type="checkbox" id="beige">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="greens">
                                    Greens
                                    <input type="checkbox" id="greens">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="yellows">
                                    Yellows
                                    <input type="checkbox" id="yellows">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                        </div> -->
                                    </div>
                                </div>

                                <div class="col-lg-9 col-md-9">

                                    <!-- search-results.ejs -->
                                    <!-- <h2>Search Results</h2> -->
                                    <section class="shop spad">
                                        <form class="search-form " action="/search" method="GET">
                                            <input type="text" name="query" placeholder="Search products...">
                                            <button type="submit"><svg class="search-icon"
                                                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                    <path
                                                        d="M15.5 14h-.79l-.28-.27c1.2-1.39 1.98-3.18 1.98-5.23 0-4.42-3.58-8-8-8s-8 3.58-8 8 3.58 8 8 8c2.05 0 3.84-.78 5.23-1.98l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-7.5 0C6.01 14 4 11.99 4 9.5S6.01 5 8.5 5 13 7.01 13 9.5 10.99 14 8.5 14z" />
                                                </svg></button>
                                        </form>
                                        <div class="row">
                                            <% products.forEach(function(product) { %>
                                                <div class="col-lg-4 col-md-6">
                                                    <div class="product__item mt-3">
                                                        <div class="product__item__pic set-bg">
                                                            <a href="/product-details/<%= product._id %>">
                                                                <div class="product__item__pic2 set-bg">
                                                                <img src="uploads/<%= product.productimage[0] %>"
                                                                    alt="">
                                                                </div>
                                                            </a>
                                                            <ul class="product__hover">
                                                                <li><a href="uploads/<%= product.productimage[0] %>"
                                                                        class="image-popup"><span
                                                                            class="arrow_expand"></span></a></li>
                                                                <!-- <li><a href="#"><span class="icon_heart_alt"></span></a></li> -->
                                                                <li><a href="#" data-value="<%= product._id%>"
                                                                        class="add-produtToWishlist btn-product-icon btn-wishlist btn-expandable"><span
                                                                            class="icon_heart_alt">
                                                                        </span></a></li>


                                                                <li><a onclick="cartIncrement('<%= product._id %>')"><span
                                                                            class="icon_bag_alt"></span></a></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="product__item__text">
                                                        <div class="product__name">
                                                        <%= product.productname %> <br>
                                                    </div>
                                                        &#x20B9;<%= product.productpromotionalprice %> 
                                                                <span>&#x20B9;<%= product.productregularprice %></span>
                                                            
                                                    </div>
                                                </div>
                                                <% }); %>
                                        </div>


                                </div>

                                <div class="col-lg-12 text-center">
                                    <!-- <div class="pagination__option">
                                        <button onclick="backbtn()"><i class="fa fa-angle-left"></i></button>
                                        <a href="#" class="link active" onclick="activelink(event)" data-value="1">1</a>
                                        <a href="#" class="link" onclick="activelink(event)" data-value="2">2</a>
                                        <a href="#" class="link" onclick="activelink(event)" data-value="3">3</a>
                                        <a href="#" class="link" onclick="activelink(event)" data-value="3">4</a>
                                        <a href="#" class="link" onclick="activelink(event)" data-value="3">5</a>
                                        <button onclick="nextbtn()"><i class="fa fa-angle-right"></i></button>
                                    </div> -->
                                    <%-include('pagination')-%>
                                </div>


                            </div>
                            </div>
                            </section>

                            <!-- Footer Section Begin -->
                            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                            <!-- <script src="user/assets/js/jquery.magnific-popup.min.js"></script> -->
                            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                            <script src="https://unpkg.com/sweetalert@2"></script>

                            <%-include('../partials/userfooter')-%>
                                <script>
                                    function cartIncrement(productid) {
                                        console.log("aaaa");
                                        // let count = document.querySelector('.cart-count')
                                        // let val = parseInt(count.textContent)
                                        $.ajax({
                                            url: '/addToCart',
                                            data: {
                                                productid: productid
                                            },
                                            method: 'post',
                                            success: (response) => {
                                                if (response.response) {
                                                    console.log("bbbbbbbbbbbbbbbbbbbbbbb");
                                                    console.log(response);
                                                    // alert('added to cart')
                                                    // location.reload()
                                                    if (response.limit) {
                                                        Swal.fire(
                                                            'sorry!',
                                                            'sorry you have only buy 10 quantity or product i sout of stock',
                                                            'warning'
                                                        )
                                                    } else {

                                                        console.log("hqaifff");
                                                        // document.querySelector('.cart-count').textContent=val+1
                                                        Swal.fire({
                                                            position: 'top',
                                                            icon: 'success',
                                                            title: 'Product added to cart',
                                                            showConfirmButton: false,
                                                            timer: 1600
                                                        })
                                                        .then(() => {
                                                            location.reload()
                                                        })
                                                    }
                                                } else {
                                                    Swal.fire({
                                                        position: 'top',
                                                        icon: 'alert',
                                                        title: 'Login needed',
                                                        showConfirmButton: false,
                                                        timer: 1600
                                                    })
                                                    setTimeout(() => {

                                                        window.location = '/login'
                                                    }, 1700)
                                                }
                                            }
                                        })
                                    }


$(document).ready(function () {
  $('.add-produtToWishlist').click(function (e) {
    e.preventDefault();
    const productId = $(this).data('value');
    console.log("clicked");
    console.log("hjjjjjjjjjj", productId);
    $.ajax({
      url: '/add-to-wishList',
      type: 'post',
      data: { productId: productId }
    })
      .done((res) => {
        console.log("ssss");
        console.log(res);

        if (res.response == true) {
          Swal.fire({
            position: 'top',
            icon: 'success',
            title: 'Product added to Wishlist',
            showConfirmButton: false,
            timer: 1600
          })
            .then(() => {
              location.reload();
            });
        } else {
          if (res.message === "Product already exists in the wishlist.") {
            Swal.fire({
              position: 'top',
              icon: 'error',
              title: 'Product already added to Wishlist',
              showConfirmButton: false,
              timer: 1600
            });
          } else {
                                                    Swal.fire({
                                                        position: 'top',
                                                        icon: 'alert',
                                                        title: 'Login needed',
                                                        showConfirmButton: false,
                                                        timer: 1600
                                                    })
                                                    setTimeout(() => {

                                                        window.location = '/login'
                                                    }, 1700)
                                                }
        }
      })
      .fail((err) => {
        console.log(err);
      });
  });
});



                                </script>